<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Free Flexible Loan EMI Calculator for India. Calculate EMI, Loan Amount, Tenure, or Interest Rate instantly.">
  <meta name="keywords" content="free EMI calculator, loan calculator India, calculate loan tenure, interest rate calculator">
  <meta name="author" content="Your Name">
  <title>Flexible Loan EMI Calculator - Plan Your Finances</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Custom CSS -->
  <style>
    body {
      padding: 20px;
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
    }
    .container {
      max-width: 700px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      font-size: 1.8rem;
      color: #333;
    }
    .form-label {
      font-weight: bold;
      margin-bottom: 8px;
      display: block;
    }
    #result {
      margin-top: 20px;
      font-size: 1.1rem;
      color: #333;
    }
    #amortizationChart {
      margin-top: 20px;
      max-width: 100%;
      display: none;
    }
    .ad-placeholder {
      background: #e9ecef;
      padding: 10px;
      text-align: center;
      margin: 20px 0;
      border-radius: 5px;
    }
    .affiliate-links, .guide-section {
      margin-top: 20px;
      padding: 15px;
      background: #f1f3f5;
      border-radius: 5px;
    }
    .buy-coffee {
      margin-top: 20px;
      text-align: center;
    }
    footer {
      margin-top: 30px;
      text-align: center;
      color: #666;
    }
    .input-group {
      margin-bottom: 15px;
      width: 100%;
    }
    .input-group .form-control {
      display: block;
      width: 100%;
      min-width: 300px;
      max-width: 100%;
      padding: 12px;
      border-radius: 5px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
    }
    @media (max-width: 576px) {
      .input-group .form-control {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <h1>Flexible Loan EMI Calculator</h1>
    <p>Calculate EMI, Loan Amount, Tenure, or Interest Rate for any loan instantly.</p>

    <!-- Selector for Output Variable -->
    <div class="mb-3">
      <label for="calcType" class="form-label">What do you want to calculate?</label>
      <select id="calcType" class="form-select" onchange="updateInputs()">
        <option value="emi">EMI (Monthly Payment)</option>
        <option value="principal">Loan Amount</option>
        <option value="tenure">Tenure (Months)</option>
        <option value="rate">Annual Interest Rate (%)</option>
      </select>
    </div>

    <!-- Input Form -->
    <form id="emiForm">
      <div id="emiInput" class="input-group">
        <label for="emi" class="form-label">EMI (₹):</label>
        <input type="number" id="emi" class="form-control" placeholder="e.g., 5000" step="0.01" min="0">
      </div>
      <div id="principalInput" class="input-group">
        <label for="principal" class="form-label">Loan Amount (₹):</label>
        <input type="number" id="principal" class="form-control" placeholder="e.g., 100000" min="0">
      </div>
      <div id="rateInput" class="input-group">
        <label for="rate" class="form-label">Annual Interest Rate (%):</label>
        <input type="number" id="rate" class="form-control" placeholder="e.g., 8.5" step="0.1" min="0">
      </div>
      <div id="tenureInput" class="input-group">
        <label for="tenure" class="form-label">Tenure (Months):</label>
        <input type="number" id="tenure" class="form-control" placeholder="e.g., 60" min="1">
      </div>
      <button type="button" onclick="calculate()" class="btn btn-primary w-100">Calculate</button>
    </form>

    <!-- Results -->
    <div id="result"></div>
    <canvas id="amortizationChart" height="100"></canvas>

    <!-- AdSense Placeholder -->
    <div class="ad-placeholder">
      <p>Ad Space (Google AdSense Placeholder)</p>
      <!-- Replace with actual AdSense code after approval -->
    </div>

    <!-- Affiliate Links -->
    <div class="affiliate-links">
      <h3>Explore Loan Options</h3>
      <p>Check out the best personal loans in India:</p>
      <ul>
        <li><a href="https://your-affiliate-link.com" target="_blank" rel="nofollow">HDFC Bank Personal Loans</a></li>
        <li><a href="https://your-affiliate-link.com" target="_blank" rel="nofollow">SBI Personal Loans</a></li>
        <!-- Replace with actual affiliate links (e.g., CJ Affiliate, Amazon Associates) -->
      </ul>
      <p><small>Affiliate links help support this free tool.</small></p>
    </div>

    <!-- Digital Product (PDF Guide) -->
    <div class="guide-section">
      <h3>Get Our EMI Planning Guide</h3>
      <p>Download our comprehensive PDF guide to plan your loans effectively for only ₹50!</p>
      <button id="buyGuide" class="btn btn-success">Buy Now</button>
    </div>

    <!-- Buy Me a Coffee -->
    <div class="buy-coffee">
      <p>Enjoying this tool? Support us!</p>
      <a href="https://www.buymeacoffee.com/yourusername" target="_blank" class="btn btn-warning">Buy Me a Coffee</a>
    </div>

    <!-- Guide Content for SEO/AdSense -->
    <div class="guide-section">
      <h3>How to Use This Flexible EMI Calculator</h3>
      <p>This tool calculates any loan variable (EMI, Loan Amount, Tenure, or Interest Rate) based on the other three inputs. For example:</p>
      <ul>
        <li><strong>EMI</strong>: Know your monthly payment for a given loan amount, rate, and tenure.</li>
        <li><strong>Loan Amount</strong>: Find how much you can borrow based on your EMI, rate, and tenure.</li>
        <li><strong>Tenure</strong>: Calculate how long it takes to repay based on EMI, loan amount, and rate.</li>
        <li><strong>Interest Rate</strong>: Determine the rate based on EMI, loan amount, and tenure.</li>
      </ul>
      <p>Use this to compare loans, plan budgets, or negotiate terms. Always verify with your lender.</p>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>© 2025 Flexible Loan EMI Calculator. For informational purposes only.</p>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Razorpay SDK -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <!-- Calculator Logic -->
  <script>
    // Clear results
    function clearResults() {
      document.getElementById('result').innerHTML = '';
      document.getElementById('amortizationChart').style.display = 'none';
      if (window.myChart) window.myChart.destroy();
    }

    // Update input fields
    function updateInputs() {
      const calcType = document.getElementById('calcType').value;
      const inputs = ['emiInput', 'principalInput', 'rateInput', 'tenureInput'];
      const inputIds = ['emi', 'principal', 'rate', 'tenure'];

      // Reset all inputs
      inputs.forEach(input => {
        const inputElement = document.getElementById(input);
        inputElement.style.display = 'block';
        const field = document.getElementById(input.replace('Input', ''));
        field.disabled = false;
        field.value = ''; // Clear values only on calcType change
      });

      // Hide and disable the selected output field
      const outputInput = `${calcType}Input`;
      document.getElementById(outputInput).style.display = 'none';
      document.getElementById(calcType).disabled = true;

      // Focus on the first visible input
      const firstVisibleInput = inputs.find(input => input !== outputInput);
      if (firstVisibleInput) {
        document.getElementById(firstVisibleInput.replace('Input', '')).focus();
      }

      clearResults();
    }

    // Run on page load
    updateInputs();

    // Main calculation function
    function calculate() {
      const calcType = document.getElementById('calcType').value;
      let emi = parseFloat(document.getElementById('emi').value);
      let principal = parseFloat(document.getElementById('principal').value);
      let rate = parseFloat(document.getElementById('rate').value) / 100 / 12; // Monthly rate
      let tenure = parseFloat(document.getElementById('tenure').value);

      // Validate inputs
      const inputs = { emi, principal, rate: rate * 12 * 100, tenure };
      const validInputs = Object.entries(inputs)
        .filter(([key]) => key !== calcType)
        .every(([_, value]) => !isNaN(value) && value > 0);
      if (!validInputs) {
        document.getElementById('result').innerHTML = '<p class="text-danger">Please enter valid positive numbers for all visible fields.</p>';
        return;
      }

      let result;
      if (calcType === 'emi') {
        // Calculate EMI
        emi = principal * rate * Math.pow(1 + rate, tenure) / (Math.pow(1 + rate, tenure) - 1);
        result = `<p><strong>Monthly EMI:</strong> ₹${emi.toFixed(2)}</p>`;
        showAmortizationChart(principal, emi, rate, tenure);
      } else if (calcType === 'principal') {
        // Calculate Loan Amount
        principal = emi * (Math.pow(1 + rate, tenure) - 1) / (rate * Math.pow(1 + rate, tenure));
        result = `<p><strong>Loan Amount:</strong> ₹${principal.toFixed(2)}</p>`;
        showAmortizationChart(principal, emi, rate, tenure);
      } else if (calcType === 'tenure') {
        // Calculate Tenure
        tenure = calculateTenure(emi, principal, rate);
        if (tenure === null) {
          document.getElementById('result').innerHTML = '<p class="text-danger">Unable to calculate tenure. Check inputs (e.g., EMI may be too low).</p>';
          return;
        }
        result = `<p><strong>Tenure:</strong> ${tenure.toFixed(0)} months</p>`;
        showAmortizationChart(principal, emi, rate, tenure);
      } else if (calcType === 'rate') {
        // Calculate Interest Rate
        rate = calculateRate(emi, principal, tenure);
        if (rate === null) {
          document.getElementById('result').innerHTML = '<p class="text-danger">Unable to calculate rate. Check inputs (e.g., EMI may be too low).</p>';
          return;
        }
        result = `<p><strong>Annual Interest Rate:</strong> ${(rate * 12 * 100).toFixed(2)}%</p>`;
        showAmortizationChart(principal, emi, rate, tenure);
      }

      // Display result
      document.getElementById('result').innerHTML = result;
    }

    // Calculate Tenure using binary search
    function calculateTenure(emi, principal, rate) {
      let low = 1, high = 1200; // Max 100 years
      let maxIterations = 100, epsilon = 0.01;
      for (let i = 0; i < maxIterations; i++) {
        let mid = (low + high) / 2;
        let calculatedEMI = principal * rate * Math.pow(1 + rate, mid) / (Math.pow(1 + rate, mid) - 1);
        if (Math.abs(calculatedEMI - emi) < epsilon) return mid;
        if (calculatedEMI > emi) low = mid + 1;
        else high = mid - 1;
      }
      return null;
    }

    // Calculate Interest Rate using bisection
    function calculateRate(emi, principal, tenure) {
      let low = 0.000001, high = 0.1; // Monthly rate (0.0001% to 120% annual)
      let maxIterations = 100, epsilon = 0.00001;
      for (let i = 0; i < maxIterations; i++) {
        let mid = (low + high) / 2;
        let calculatedEMI = principal * mid * Math.pow(1 + mid, tenure) / (Math.pow(1 + mid, tenure) - 1);
        if (Math.abs(calculatedEMI - emi) < epsilon) return mid;
        if (calculatedEMI < emi) low = mid + 0.00001;
        else high = mid - 0.00001;
      }
      return null;
    }

    // Show amortization chart
    function showAmortizationChart(principal, emi, rate, tenure) {
      let balances = [];
      let remaining = principal;
      for (let i = 0; i < tenure; i++) {
        let interest = remaining * rate;
        let principalPaid = emi - interest;
        remaining -= principalPaid;
        balances.push(remaining.toFixed(2));
      }

      let ctx = document.getElementById('amortizationChart').getContext('2d');
      document.getElementById('amortizationChart').style.display = 'block';
      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({ length: tenure }, (_, i) => i + 1),
          datasets: [{
            label: 'Remaining Balance (₹)',
            data: balances,
            borderColor: '#007bff',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: { title: { display: true, text: 'Month' } },
            y: { title: { display: true, text: 'Balance (₹)' } }
          }
        }
      });
    }

    // Razorpay Payment
    document.getElementById('buyGuide').onclick = function () {
      let options = {
        key: 'YOUR_RAZORPAY_KEY_ID', // Replace with your Razorpay Key ID
        amount: 5000, // ₹50 in paise
        currency: 'INR',
        name: 'EMI Planning Guide',
        description: 'Comprehensive EMI Planning PDF',
        handler: function (response) {
          alert('Payment successful! Download link sent to your email.');
          // Add logic for PDF delivery
        },
        prefill: {
          name: 'Customer Name',
          email: 'customer@example.com'
        },
        theme: { color: '#28a745' }
      };
      let rzp = new Razorpay(options);
      rzp.open();
    };
  </script>
</body>
</html>